/*************************************************************************************************\
* Наименование: Базовый объект формирования запросов и JSON произвольной структуры                *
* Контур/Модуль: Абстрактный конструктор JSON                                                     *
* Примечание:                                                                                     *
*                                                                                                 *
* Вид работы  |Номер         |Дата    |Исполнитель              |Проект                           *
* ----------------------------------------------------------------------------------------------- *

\*************************************************************************************************/
/*
x$journal.status = 2 - insert
x$journal.status = 4 - update
x$journal.status = 8 - delete
*/

#include Query.vih
#include JRN_TRACKING_BASE.vih

//************************************************************
const
end;
Interface JRN_TRACKING_TEST 'Демонстрация функциональности JRN_TRACKING';
create view
 var
   _strtohash : string;
   iJRN_TRACKING_BASE : JRN_TRACKING_BASE;
   _cntTop : longint;
   _enableLog : boolean = false;
;
 Screen ScrJRN_TRACKING_PUBLICATION_TERMS_Edit (,,Sci18Esc);
   Notablenavigation;
   fields
!    _strtohash          : noprotect;
!    iJRN_TRACKING_BASE.GetHash(_strtohash) : protect;
    _cntTop    : noprotect;
    _enableLog : noprotect;
    buttons
     cmValue1,,,;
     cmValue2,,,;
     cmValue3,,,;
<<
Демонстрация работы JRN_TRACKING

<. Последние NREC журнала по офисам .> - просмотр и редактирование последнего NREC журнала

<.    Просмотр условий публикации   .> - просмотр и редактирование условий публикации

<.        Обработать журнал         .> - обработка идет пулом по .@@@@@@@@@@@@@@ записей журнала
                                          [.] вести лог работы обработки журнала`

!.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

!.@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

>>
    end;//Screen ScrQRY_getParameter
handleevent
cmValue1: {
  var iJRN_TRACKING_BASE : JRN_TRACKING_BASE;
  iJRN_TRACKING_BASE.Show_LastNrecs;
}
cmValue2: {
 runinterface('C_JRN_TRACKING::JRN_TRACKING_PUBLICATION_TERMS');
}
cmValue3: {
  var iJRN_TRACKING_BASE : JRN_TRACKING_BASE new;
  if not loadvipinterface(iJRN_TRACKING_BASE) then exit;

  if _enableLog
    then iJRN_TRACKING_BASE.enableLog
    else iJRN_TRACKING_BASE.disableLog;

  iJRN_TRACKING_BASE.processJRNAllOffice(_cntTop);
  putfiletoclient(iJRN_TRACKING_BASE.GetLogFile, false);
  freevipinterface(iJRN_TRACKING_BASE);
  message('готово');
}
cmcheckfield:{
  rereadrecord;
}
end;
end.
